
<div class="container" style="margin-top: 80px">
  <div class="row">
    <div class="col-md-8">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Panel title</h3>
        </div>
        <div class="panel-body">
          Panel content
        </div>
      </div>
      <% @users.each do |user| %>
        <% if user != current_user %>
          <div class="row">
            <div class="col-md-12">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="col-md-2" style="margin: -15px">
                    <%= image_tag user.image.url, style: "height: 80; width: 80", class: "img-responsive" %>
                  </div>
                  <div class="col-md-3 name2">
                    <a href="<%= user_path(user) %>"><%= user.name.capitalize %></a>
                    <a href="<%= user_path(user) %>"><%= user.email %></a>
                  </div> 
                  <div class="col-md-1">
                  </div> 
                  <div class="col-md-5 col-md-push-2">
                    <% is_friend = current_user.friends.include?(user) %>
                    <% accepted = current_user.friendships.where(accepted: true) %>
                    <% accepted_user = user.friendships.where(accepted: true)  %>
                    <% accepted_friend = accepted.find_by(user_id: user.id) || accepted.find_by(friend_id: user.id) || accepted_user.find_by(user_id: user.id) || accepted_user.find_by(friend_id: user.id) %>
                    <% i_friend_of_u = user.friends.include?(current_user) %>
                    <% if !is_friend && !i_friend_of_u %>
                    <div class="row" style="margin-top: 10px">
                      <div class="col-md-2 col-md-push-5"> 
                        <%= link_to '+  Add Friend', friends_path(friend_id: user), method: :post, class: "font btn btnfriend", style: "max-height: 25px; min-width: 130px; font-size: 110%" %>
                      </div>  
                      <% elsif !is_friend && i_friend_of_u && !accepted_friend %>
                        <%= link_to 'Accept Friend Request', friend_path(id: user.id), method: :patch, class: "font btn btnfriend", style: "max-height: 20px; min-width: 130px; font-size: 80%" %>
                        <%= link_to 'Ignore Friend Request', friend_path(id: user.id), method: :delete, class: "font btn btn-default", style: "max-height: 20px; min-width: 130px; font-size: 80%" %> 
                      <% elsif is_friend && !accepted_friend %>
                        <span class="label label-success" style="max-height: 20px; min-width: 130px; font-size: 80%">Friend Request Sent</span>
                        <%= link_to 'Cancel Friend Request', friend_path(id: current_user.id), method: :delete, class: "font btn btn-default", style: "max-height: 20px; min-width: 130px; font-size: 80%; margin-top: 10px" %>
                      <% end %>                               
                      <% if accepted_friend %>
                        <%= link_to 'Cancel Friendship', friend_path(id: user.id), method: :delete, data: { confirm: 'Are you sure you want to cancel friendship?' }, class: "font btn btn-default", style: "max-height: 20px; min-width: 130px; font-size: 80%" %>
                      <% end %>
                    </div> 
                </div>
              </div>
            </div>  
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
